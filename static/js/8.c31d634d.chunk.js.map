{"version":3,"sources":["components/common/FormsControls/CustomFormControls.tsx","assets/images/default-user.png","components/common/FormsControls/CustomFormControls.module.sass","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js","components/Dialogs/Dialogs.module.sass","components/Dialogs/Dialog/Dialog.module.sass","components/Dialogs/Message/Message.module.sass","assets/images/send-message_white.svg","assets/images/arrow-left.svg","components/Dialogs/Dialog/Dialog.tsx","components/Dialogs/Message/Message.tsx","components/Dialogs/Dialogs.tsx","hoc/withAuthRedirect.tsx","redux/dialogs-selectors.ts","components/Dialogs/DialogsContainer.tsx"],"names":["CustomField","React","memo","name","label","fieldType","maxLength","placeholder","type","onKeyDown","autoFocus","useField","field","error","touched","textareaRef","useRef","useEffect","current","autosize","inputGroup","htmlFor","as","id","className","s","simpleField","maxLengthCounter","value","length","errorContainer","textareaGroup","rows","ref","checkboxGroup","checkboxInput","checked","fieldError","currentLength","cn","fieldGroup","inputGroupSwitcher","module","exports","_objectWithoutProperties","source","excluded","key","i","target","sourceKeys","Object","keys","indexOf","getOwnPropertySymbols","sourceSymbolKeys","prototype","propertyIsEnumerable","call","Dialog","user","dialog","to","userId","activeClassName","active","src","photos","small","defaultUserImg","alt","fullName","PreloaderSmall","Message","messageText","from","date","opponent","opponentName","message","myMessage","messageInnerContainer","messageFrom","time","timestamp","Date","getHours","getMinutes","substr","timeConverter","Dialogs","props","dialogs","messages","sendMessage","currentDialogId","currentUser","isMessageFetching","isMessagesLoading","findUserInUsersArray","submitSendMessage","values","actions","a","now","dialogsScrollTo","resetForm","setFieldError","dialogsScrollToRef","scrollTo","scrollHeight","dialogsListRef","showDialogsListRef","dialogsListRefTarget","showDialogsListRefTarget","hideDialogs","style","left","userFullName","onClick","showDialogsList","arrowBackImg","dialogsContainer","dialogsList","map","opponentUser","opponentId","userName","messagesList","Preloader","initialValues","general","onSubmit","formik","sendMessageBlock","e","shiftKey","preventDefault","handleSubmit","errors","formSummaryError","sendImg","noDialogMessage","mapStateToProps","state","isAuth","auth","getCurrentDialogId","dialogsPage","getCurrentUser","getMessages","getDialogs","getUsers","users","getIsMessageFetching","getIsMessagesLoading","DialogsContainer","setCurrentDialogIdFromUrl","dialogId","match","params","dialogIdNumber","Number","Promise","resolve","reject","checkUser","then","setCurrentDialogId","catch","setUsersFromDialogsArray","forEach","setUser","thisUser","this","prevProps","setCurrentUser","Helmet","setDialog","PureComponent","mapDispatchToProps","compose","connect","withRouter","WrappedComponent","restProps"],"mappings":"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","file":"static/js/8.c31d634d.chunk.js","sourcesContent":["import React, {useEffect, useRef} from 'react'\r\nimport s from './CustomFormControls.module.sass'\r\nimport {Field, useField} from \"formik\"\r\nimport cn from 'classnames'\r\nimport autosize from \"autosize\"\r\n\r\n\r\n\r\ntype CustomFieldType = {\r\n    name: string\r\n    fieldType: string\r\n    label?: string\r\n    maxLength?: number\r\n    placeholder?: string\r\n    type?: string\r\n    onKeyDown?: (e: React.KeyboardEvent<HTMLElement>) => void\r\n    autoFocus?: boolean\r\n}\r\n\r\nexport const CustomField: React.FC<CustomFieldType> = React.memo(({\r\n            name,\r\n            label,\r\n            fieldType,\r\n            maxLength,\r\n            placeholder,\r\n            type,\r\n            onKeyDown,\r\n            autoFocus,\r\n}) => {\r\n\r\n    const [field, {error, touched}] = useField(name)\r\n\r\n    const textareaRef = useRef<HTMLTextAreaElement>(null)\r\n\r\n    // const textareaAutosizeTyping = () => {\r\n    //     const target = textareaRef.current\r\n    //     if(target !== null){\r\n    //         autosize(target)\r\n    //     }\r\n    // }\r\n\r\n    useEffect(() => {\r\n        if(textareaRef && textareaRef.current){\r\n            autosize(textareaRef.current)\r\n        }\r\n\r\n    })\r\n\r\n\r\n\r\n\r\n\r\n    const inputGroupSwitcher = () => {\r\n        switch (fieldType) {\r\n            case 'input':\r\n                return inputGroup()\r\n\r\n            case 'textarea':\r\n                return textareaGroup()\r\n\r\n            case 'checkbox':\r\n                return checkboxGroup()\r\n\r\n            default:\r\n                return inputGroup()\r\n        }\r\n    }\r\n\r\n    const inputGroup = () => {\r\n        return (\r\n            <>\r\n                {!!label &&\r\n                    <label htmlFor={'form-'+name}>{label}</label>\r\n                }\r\n\r\n                <Field\r\n                    as='input'\r\n                    id={'form-'+name}\r\n                    className={s.simpleField}\r\n                    placeholder={placeholder}\r\n                    maxLength={maxLength}\r\n                    type={type}\r\n                    autoFocus={autoFocus}\r\n\r\n                    {...field}\r\n                />\r\n\r\n                {maxLengthCounter(field.value.length, maxLength)}\r\n                {errorContainer(error, touched)}\r\n            </>\r\n        )\r\n    }\r\n\r\n    const textareaGroup = () => {\r\n        return (\r\n            <>\r\n                {!!label &&\r\n                    <label htmlFor={'form-'+name}>{label}</label>\r\n                }\r\n\r\n                <textarea\r\n                    id={'form-'+name}\r\n                    rows={1}\r\n                    ref={textareaRef}\r\n                    className={s.simpleField}\r\n                    placeholder={placeholder}\r\n                    maxLength={maxLength}\r\n                    onKeyDown={onKeyDown}\r\n                    autoFocus={autoFocus}\r\n                    {...field}\r\n                />\r\n\r\n                {maxLengthCounter(field.value.length, maxLength)}\r\n                {errorContainer(error, touched)}\r\n            </>\r\n        )\r\n    }\r\n\r\n    const checkboxGroup = () => {\r\n        return (\r\n            <>\r\n                <div className={s.checkboxInput}>\r\n                    <Field\r\n                        id={'form-'+name}\r\n                        type='checkbox'\r\n                        checked={field.value}\r\n                        placeholder={placeholder}\r\n                        {...field}\r\n                    />\r\n                    <label htmlFor={'form-'+name}>{label}</label>\r\n                </div>\r\n\r\n                {errorContainer(error, touched)}\r\n            </>\r\n        )\r\n    }\r\n\r\n\r\n    const errorContainer = (error: any, touched: any) => {\r\n        if(error && touched){\r\n            return (\r\n                <div className={s.fieldError}>{error}</div>\r\n            )\r\n        }\r\n    }\r\n\r\n    const maxLengthCounter = (currentLength: number, maxLength: number | undefined) => {\r\n        if(maxLength) {\r\n            return (\r\n                <div className={cn(s.maxLength, {[s.error]: currentLength >= maxLength})}>\r\n                    {currentLength}/{maxLength}\r\n                </div>\r\n            )\r\n        }\r\n    }\r\n\r\n\r\n\r\n    return (\r\n        <div className={s.fieldGroup}>\r\n            {inputGroupSwitcher()}\r\n        </div>\r\n    )\r\n})\r\n\r\n\r\n\r\n","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpFNzg0MTZGRTE3M0UxMUUzOTYyOEE4QkM2OUVGODdCNyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpFNzg0MTZGRjE3M0UxMUUzOTYyOEE4QkM2OUVGODdCNyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkU3ODQxNkZDMTczRTExRTM5NjI4QThCQzY5RUY4N0I3IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkU3ODQxNkZEMTczRTExRTM5NjI4QThCQzY5RUY4N0I3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+b5NvTwAAADNQTFRF3t7e6urq/Pz89PT01tbW5OTk9/f33Nzc+vr62dnZ7+/v7Ozs5+fn8vLy4eHh09PT////tFz3VwAABsRJREFUeNrs3el23SoMBlAmg40H/P5Pe9vbrnS1x0mOGYQlPv1u2noHsMwkdSLeDgUCYAELWMACFrBAACxgAQtYwAIWCIAFLGABC1jAAgGwgAUsYAELWCAAFrCABSxgAQsEwAIWsIAFLGCBAFjAAhawcsNYqz8i2hlY1zHHTbn0b4RptcD6O/ZpSZ/Hsc7A+pBy6bsIT/DqjjXrJb0Xhx0ca57SjVjiwFj3qPpzdcQyW8oIZUfE2l3Ki8mMhmWOlB1uHwsru1l1bVx9sLZUGMGPgmVUKo4uXbEDlg+pRsQRsLxLdWKSj1XNqoOW4mtFr6UYW5FrKc5WKWm5WCak2hHFYqnqVsl5oVg6NYjFiMSyqUkcErGMa4OVVoFYRyOr5GZxWHtqFkoallnaYaVdGJZuaEX2RlTMR3fSRJ4Ia2pqlZwRhDWnxqEFYW2tsWialhIwYpFlpiRYa3OrtIjBWtpjJSsEyxNYkUyaKgnDO9UQr4T0QpJvHiWkF5L0QwIsTYPlRGApGqzkJWARWRHkpe2xLBXWIQBLU2EtArAOKqxk+GMFMizLH4vMqv0I3xzL0GFp9liWDmsC1oPWD5v/AxFYD0yzgHUvgAUsYAELAzwh1gosJKXcsQ72WDMdFv8PaUzRYPIP08oDLVi0X2UVtBSmBGAZMS9DihXpIGV8p8DapAxZFFhWSP5Os5nNkWBFGViTjCyLBmsX0gvlbO3epWARJPFyDg3MEjJSKiyCIV7OQaf2TYvmUhoZhzPTLAmrcdPaTklYbT8QnawD5W3PZ1LdGUJ2gUTDfVrhlIbV8FSKl4c1O875KDFWq44YTolYbZItN8vEMi1m4ymvDSa986/BsLWeUrHqX71Je1Ep8aWukbMV+XXBVbWCkY1VU4vaqsMV55FpHzz7XJ7vmFp1KctQpdTAeo6BVVRH5nfe3qVUUadSMoW745XIUjLG/iyFeVFur6QrutcuaOLPQpvWc8Xy6/QHZHrlyl55Va9/1/rxzliU3g0vLBNf6ju+zjrNWSPXRR06+28rbVU5sgWWv6yEeVGEyd6ePXX6pdlcF7MLkQXW5wL6LOS6oDrtcuMPPwzLf/X0VxW+7NtTgiG+Pv2XNRLd+misb+s7Xv22zfrGm9FNV286+81mpmCfi2W/34i1XP735/XL7rhsl/Oh5o1GqZ+K9V4ycHwylFitrqzVFj95tcW3vjHD/EQsM+XnlH/Edq0n9St+JLNf1HP3774aKhabqYZ1ZzViKR5K7tQJdvFpWDdXbspq9hp9b5YnPgvr/ipXPtddqnpaqpNVNlcGVbXVxTpYmfNT979JfOaqdp1RvgpW/k41t914s5uYvxOnSgGVGlhlJyjenSLYp6K5e/UMrPJF+aD97SmfHjuTKmBV2aXmDm2ve4qPW50NJf4BWBUvm1l+ZO3W/kbz1q76qLhfMPTHmmlOEz5ii2Ax1sHGqnzfWymWTYzi6IylOGGVHtAvxIqsrEqTrcIfX3hhFTatMqydmVVh01IDjVjFTUsN8yqssKurCGvih1V0jLMEyzC0KkrjS7BWjlhLJ6yFI1bJDHMBlmdpVTLEF2BtPLFcFyyevbCkH6rRemFJP1Sj9cKSfpiPFbhi5X/yZGPNbK3y7xfJxop8sQI51sEXK/v7MBvLMcaKxFiesVV28pCLtXLGCsRYE2es3EvvcrEW1liWFMuwtsqdAczEsryxDlIszRtrIcXiPb7njvCZWIE5lqXEYm6VedFBHpbnjrURYlnuWIoQS3PHWgixNu5YiRBLscfydFiBPZalw2JvlZc7jIqlybAsf6wNWI0TrawfisAaKCfNXMMfFSuRYU3AGimBz1uVHhbLAuuBWAuwRvraAVbzL+lhsTSwgAUsYAELWMAiwpqBhZYFLGABSyiWE4CFyb8nYmHBAuuGWL7/JOhWpA1/LLpdNAJWLAg3s2FP6Y3YuVsdhFjs09JIicU803KkB52Yn0fJPFGee+yX9xfPTIvFOi/NbiHngE3LU2P54UasMe/PMvRYBtfYye+IfW6T5Hl2IJg+WByHraLKTmVXnLP76imrGVZYaYCZVigrVFRa8GMdZbyqgXVaPrM1W+mzlpe/MkyuSnTlBSGrlOzjkJ5uFQocVikGmVf6kzQTrVJNulYB2/jg1uWmSoW36xXd9tMzvY5oaj1izXLup9fqWf0xbLup+HxVsf7fcGq1PlT/2PRuaz9bdSzJASxgAQtYwAIWAljAAhawgAUsBLCABSxgAQtYCGABC1jAAhawEMACFrCABSxgIYAFLGABC1jAQgALWMACFrCAhQDWjfhPgAEAhq5lUETgnMAAAAAASUVORK5CYII=\"","// extracted by mini-css-extract-plugin\nmodule.exports = {\"fieldGroup\":\"CustomFormControls_fieldGroup__3ichb\",\"simpleField\":\"CustomFormControls_simpleField__21tGG\",\"maxLength\":\"CustomFormControls_maxLength__1jqRO\",\"error\":\"CustomFormControls_error__bVcUE\",\"fieldError\":\"CustomFormControls_fieldError__MVOSL\",\"checkboxInput\":\"CustomFormControls_checkboxInput__xnNWt\"};","import objectWithoutPropertiesLoose from \"./objectWithoutPropertiesLoose\";\nexport default function _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n  var target = objectWithoutPropertiesLoose(source, excluded);\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}","export default function _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}","// extracted by mini-css-extract-plugin\nmodule.exports = {\"dialogs\":\"Dialogs_dialogs__azdOc\",\"showDialogsList\":\"Dialogs_showDialogsList__17vwK\",\"dialogsContainer\":\"Dialogs_dialogsContainer__1N79k\",\"dialogsList\":\"Dialogs_dialogsList__3HEzI\",\"messagesList\":\"Dialogs_messagesList__2HwY3\",\"userName\":\"Dialogs_userName__9Hulc\",\"sendMessageBlock\":\"Dialogs_sendMessageBlock__2OxWB\",\"noDialogMessage\":\"Dialogs_noDialogMessage__MvAt8\",\"formSummaryError\":\"Dialogs_formSummaryError__2xduC\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"dialog\":\"Dialog_dialog__2dEEq\",\"user\":\"Dialog_user__2rFFt\",\"active\":\"Dialog_active__2dkw_\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"message\":\"Message_message__2LqB3\",\"messageInnerContainer\":\"Message_messageInnerContainer__eXKYE\",\"messageFrom\":\"Message_messageFrom__1V-4M\",\"time\":\"Message_time__Hvkbo\",\"myMessage\":\"Message_myMessage__YwGM2\"};","module.exports = __webpack_public_path__ + \"static/media/send-message_white.147a79aa.svg\";","module.exports = __webpack_public_path__ + \"static/media/arrow-left.55da2725.svg\";","import React from 'react'\r\nimport s from './Dialog.module.sass'\r\nimport {NavLink} from 'react-router-dom'\r\nimport PreloaderSmall from \"../../common/PreloaderSmall/PreloaderSmall\"\r\nimport defaultUserImg from '../../../assets/images/default-user.png'\r\nimport {ProfileType} from \"../../../types/Profile\"\r\n\r\n\r\n\r\ntype PropsType = {\r\n    user: ProfileType | null\r\n}\r\n\r\nconst Dialog: React.FC<PropsType> = React.memo(({user}) => {\r\n\r\n    return (\r\n        <div className={s.dialog}>\r\n            {!!user &&\r\n                <NavLink to={'/dialogs/'+user.userId} activeClassName={s.active} className={s.user}>\r\n                    <img src={user.photos && (user.photos.small || defaultUserImg)} alt={user.fullName}/>\r\n                    <span>{user.fullName}</span>\r\n                </NavLink>\r\n            }\r\n            {!user &&\r\n                <PreloaderSmall />\r\n            }\r\n        </div>\r\n    )\r\n\r\n})\r\n\r\n\r\n\r\nexport default Dialog","import React from 'react'\r\nimport s from './Message.module.sass'\r\nimport cn from 'classnames'\r\nimport {ProfileType} from \"../../../types/Profile\"\r\n\r\n\r\n\r\ntype PropsType = {\r\n    messageText: string\r\n    from: string\r\n    date: number\r\n    opponent: ProfileType | null\r\n}\r\n\r\nconst Message: React.FC<PropsType> = React.memo(({\r\n                                messageText,\r\n                                from,\r\n                                date,\r\n                                opponent\r\n                                }) => {\r\n\r\n\r\n\r\n    const timeConverter = (timestamp: number) => {\r\n        const date = new Date(timestamp)\r\n        const hours = date.getHours()\r\n        const minutes = \"0\" + date.getMinutes()\r\n        return hours + ':' + minutes.substr(-2)\r\n    }\r\n\r\n    let opponentName = 'opponent:'\r\n    if(opponent) {\r\n        opponentName = opponent.fullName+':'\r\n    }\r\n\r\n    return (\r\n        <div className={cn(s.message, {[s.myMessage]: from==='me'})}>\r\n            <div className={s.messageInnerContainer}>\r\n                <div className={s.messageFrom}>{from === 'me' ? 'me:' : opponentName}</div>\r\n                <div className={s.messageText}>{messageText}</div>\r\n                <div className={s.time}>{timeConverter(date)}</div>\r\n            </div>\r\n        </div>\r\n    )\r\n})\r\n\r\n\r\n\r\nexport default Message","import React, {useEffect, useRef} from 'react'\r\nimport s from './Dialogs.module.sass'\r\nimport Dialog from './Dialog/Dialog'\r\nimport Message from './Message/Message'\r\nimport cn from 'classnames'\r\nimport {CustomField} from \"../common/FormsControls/CustomFormControls\"\r\nimport {Form, Formik} from \"formik\"\r\nimport sendImg from '../../assets/images/send-message_white.svg'\r\nimport arrowBackImg from '../../assets/images/arrow-left.svg'\r\nimport Preloader from \"../common/Preloader/Preloader\"\r\nimport {DialogType} from \"../../types/Dialog\"\r\nimport {MessageType} from \"../../types/Message\"\r\nimport {ProfileType} from \"../../types/Profile\"\r\n\r\n\r\n\r\ntype PropsType = {\r\n    dialogs: Array<DialogType>\r\n    messages: Array<MessageType>\r\n    users: Array<ProfileType>\r\n    currentDialogId: number | null\r\n    currentUser: ProfileType | null\r\n    isMessageFetching: boolean\r\n    isMessagesLoading: boolean\r\n\r\n    sendMessage: (userId: number, newMessage: string, date: number) => void\r\n    setDialog: (userId: number) => void\r\n    findUserInUsersArray: (userId: number) => ProfileType | null\r\n}\r\n\r\ninterface FormValuesType {\r\n    message: string\r\n    general: string\r\n}\r\n\r\nconst Dialogs = React.memo((props: PropsType) => {\r\n\r\n    const initialValues: FormValuesType = { message: '', general: '' }\r\n\r\n    const {dialogs,\r\n        messages,\r\n        sendMessage,\r\n        currentDialogId,\r\n        currentUser,\r\n        isMessageFetching,\r\n        isMessagesLoading,\r\n        findUserInUsersArray} = props\r\n\r\n\r\n\r\n    const submitSendMessage = async (values: any, actions: any) => {\r\n        if (values.message.length > 0 && !isMessageFetching && !isMessagesLoading) {\r\n            try{\r\n                if(currentDialogId){\r\n                    await sendMessage(currentDialogId, values.message, Date.now())\r\n                    dialogsScrollTo()\r\n                    actions.resetForm({message: ''})\r\n                }\r\n            }catch(error){\r\n                actions.setFieldError('general', error)\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    /* Scrolls down all messages after sending one and in the beginning */\r\n    const dialogsScrollToRef = useRef<HTMLDivElement>(null)\r\n\r\n    const dialogsScrollTo = () => {\r\n        const target = dialogsScrollToRef.current\r\n        if(target){\r\n            target.scrollTo(0,target.scrollHeight)\r\n        }\r\n\r\n    }\r\n\r\n    useEffect(()=>{\r\n        dialogsScrollTo()\r\n    })\r\n\r\n\r\n\r\n    /* Mobile versions animation */\r\n    const dialogsListRef = useRef<HTMLDivElement>(null)\r\n    const showDialogsListRef = useRef<HTMLDivElement>(null)\r\n    const dialogsListRefTarget = dialogsListRef.current\r\n    const showDialogsListRefTarget = showDialogsListRef.current\r\n\r\n    const showDialogs = () => {\r\n        if(dialogsListRefTarget && showDialogsListRefTarget){\r\n            dialogsListRefTarget.style.left = '0px'\r\n            showDialogsListRefTarget.style.left = '200%'\r\n        }\r\n    }\r\n    const hideDialogs = () => {\r\n        if(dialogsListRefTarget && showDialogsListRefTarget){\r\n            dialogsListRefTarget.style.left = '-100%'\r\n            showDialogsListRefTarget.style.left = '0px'\r\n        }\r\n    }\r\n\r\n    useEffect(()=>{\r\n        if(!!currentDialogId){\r\n            hideDialogs()\r\n        }\r\n    })\r\n\r\n\r\n    const userFullName = currentUser && currentUser.fullName\r\n\r\n\r\n\r\n    return (\r\n        <div className={s.dialogs}>\r\n\r\n            <div ref={showDialogsListRef} onClick={showDialogs} className={s.showDialogsList}>\r\n                <img src={arrowBackImg} alt=\"show dialogs\"/>\r\n                <span>{!isMessagesLoading && userFullName}</span>\r\n            </div>\r\n\r\n            <div ref={dialogsScrollToRef} className={s.dialogsContainer}>\r\n\r\n                <div ref={dialogsListRef} onClick={hideDialogs} className={s.dialogsList}>\r\n                    {dialogs.map(dialog => {\r\n                        const opponentUser: ProfileType | null = findUserInUsersArray(dialog.opponentId)\r\n                        return <Dialog\r\n                            key={dialog.id}\r\n                            user={opponentUser}\r\n                        />\r\n                    })}\r\n                </div>\r\n\r\n                <div className={s.userName}>{!(isMessageFetching || isMessagesLoading) && userFullName}</div>\r\n\r\n                <div className={s.messagesList}>\r\n                    {!isMessagesLoading &&\r\n                        <>\r\n                            {messages.map(message => {\r\n                                if (message.opponentId === currentDialogId) {\r\n                                    const opponentUser: ProfileType | null = findUserInUsersArray(message.opponentId)\r\n                                    return <Message\r\n                                        key={message.id}\r\n                                        opponent={opponentUser}\r\n                                        from={message.from}\r\n                                        messageText={message.messageText}\r\n                                        date={message.date}\r\n                                    />\r\n                                }else{\r\n                                    return null\r\n                                }\r\n                            })}\r\n                        </>\r\n                    }\r\n\r\n                    {isMessagesLoading &&\r\n                        <Preloader />\r\n                    }\r\n                </div>\r\n\r\n                {!!currentDialogId &&\r\n                    <Formik\r\n                        initialValues={initialValues}\r\n                        onSubmit={(values, actions) => {\r\n                            submitSendMessage(values, actions)\r\n                        }}\r\n                    >{formik => {\r\n                        return (\r\n                            <Form className={s.sendMessageBlock}>\r\n                                <CustomField\r\n                                    name={'message'}\r\n                                    fieldType={'textarea'}\r\n                                    placeholder={'Type something besides \"ghbdtn\" ) '}\r\n                                    onKeyDown={(e: React.KeyboardEvent<HTMLElement>) => {\r\n                                        if (e.key === 'Enter') {\r\n                                            if (!e.shiftKey) {\r\n                                                e.preventDefault()\r\n                                                formik.handleSubmit()\r\n                                            }\r\n                                        }\r\n                                    }}\r\n                                />\r\n                                {formik.errors.general ? <div className={s.formSummaryError}>{formik.errors.general}</div> : null}\r\n                                {!(isMessageFetching || isMessagesLoading) &&\r\n                                    <button type={'submit'} className={cn('button', 'button-success')}>\r\n                                        <img src={sendImg} alt=\"send message\"/>\r\n                                    </button>\r\n                                }\r\n                            </Form>\r\n                        )\r\n                    }}\r\n                    </Formik>\r\n                }\r\n\r\n                {(!currentDialogId || !currentUser) &&\r\n                    <div className={s.noDialogMessage}>\r\n                        <span>Choose user to start conversation</span>\r\n                    </div>\r\n                }\r\n\r\n            </div>\r\n        </div>\r\n    )\r\n})\r\n\r\n\r\n\r\nexport default Dialogs","import React from 'react'\r\nimport {Redirect} from \"react-router-dom\"\r\nimport {connect} from \"react-redux\"\r\nimport {AppStateType} from \"../redux/redux-store\"\r\n\r\n/* Use this hoc to pages you want to protect from non-auth users */\r\n\r\nconst mapStateToProps = (state: AppStateType) => ({\r\n    isAuth: state.auth.isAuth\r\n})\r\ntype MapStateToPropsType = ReturnType<typeof mapStateToProps>\r\ntype MapDispatchToPropsType = { }\r\n\r\nexport function withAuthRedirect<WCP> (WrappedComponent: React.ComponentType<WCP>)  {\r\n\r\n    const RedirectComponent: React.FC<MapStateToPropsType & MapDispatchToPropsType> = (props) => {\r\n        const {isAuth, ...restProps} = props\r\n\r\n        if(!isAuth) return <Redirect to='/login'/>\r\n        return <WrappedComponent {...restProps as WCP} />\r\n\r\n    }\r\n\r\n    return connect<MapStateToPropsType, MapDispatchToPropsType, WCP, AppStateType>(mapStateToProps)(RedirectComponent)\r\n}","import {AppStateType} from \"./redux-store\";\r\n\r\nexport const getCurrentDialogId = (state: AppStateType) => {\r\n    return state.dialogsPage.currentDialogId;\r\n}\r\n\r\nexport const getCurrentUser = (state: AppStateType) => {\r\n    return state.dialogsPage.currentUser;\r\n}\r\n\r\nexport const getMessages = (state: AppStateType) => {\r\n    return state.dialogsPage.messages;\r\n}\r\n\r\nexport const getDialogs = (state: AppStateType) => {\r\n    return state.dialogsPage.dialogs;\r\n}\r\n\r\nexport const getUsers = (state: AppStateType) => {\r\n    return state.dialogsPage.users;\r\n}\r\n\r\nexport const getIsMessageFetching = (state: AppStateType) => {\r\n    return state.dialogsPage.isMessageFetching;\r\n}\r\nexport const getIsMessagesLoading = (state: AppStateType) => {\r\n    return state.dialogsPage.isMessagesLoading;\r\n}","import Dialogs from './Dialogs'\r\nimport React from 'react'\r\nimport {\r\n    actions,\r\n    setUser,\r\n    sendMessage,\r\n    setCurrentUser,\r\n    checkUser\r\n} from '../../redux/dialogs-reducer'\r\nimport {connect} from \"react-redux\"\r\nimport {withAuthRedirect} from \"../../hoc/withAuthRedirect\"\r\nimport {compose} from \"redux\"\r\nimport {\r\n    getCurrentDialogId,\r\n    getCurrentUser,\r\n    getDialogs,\r\n    getIsMessageFetching,\r\n    getIsMessagesLoading,\r\n    getMessages,\r\n    getUsers\r\n} from \"../../redux/dialogs-selectors\"\r\nimport {withRouter, RouteComponentProps} from \"react-router-dom\"\r\nimport {Helmet} from \"react-helmet\"\r\nimport {DialogType} from \"../../types/Dialog\"\r\nimport {AppStateType} from \"../../redux/redux-store\"\r\n\r\n\r\n\r\ntype MapStateToPropsType = ReturnType<typeof mapStateToProps>\r\n\r\ntype MapDispatchToPropsType = {\r\n    setCurrentDialogId: (dialogId: number | null) => void\r\n    setCurrentUser: (userId: number | null) => void\r\n    sendMessage: (userId: number, newMessage: string, date: number) => void\r\n    setUser: (userId: number) => void\r\n    setDialog: (userId: number) => void\r\n    checkUser: (userId: number) => any\r\n}\r\n\r\ntype PathPropsType = {\r\n    dialogId: string\r\n}\r\n\r\ntype PropsType = MapStateToPropsType & MapDispatchToPropsType & RouteComponentProps<PathPropsType>\r\n\r\n\r\n\r\nclass DialogsContainer extends React.PureComponent<PropsType>{\r\n\r\n    componentDidMount () {\r\n        this.setCurrentDialogIdFromUrl()\r\n        this.setUsersFromDialogsArray(this.props.dialogs)\r\n    }\r\n\r\n    componentDidUpdate (prevProps: PropsType) {\r\n        this.setCurrentDialogIdFromUrl()\r\n        if(prevProps.dialogs !== this.props.dialogs){\r\n            this.setUsersFromDialogsArray(this.props.dialogs)\r\n        }\r\n        if(prevProps.currentDialogId !== this.props.currentDialogId){\r\n            this.props.setCurrentUser(this.props.currentDialogId)\r\n        }\r\n    }\r\n\r\n    setCurrentDialogIdFromUrl = () => {\r\n        // debugger\r\n        const dialogId = this.props.match.params.dialogId\r\n        const dialogIdNumber = Number(dialogId)\r\n        if (dialogId && dialogIdNumber !== this.props.currentDialogId) {\r\n            const promise = new Promise((resolve, reject) => {\r\n                const checkUserExist = this.props.checkUser(dialogIdNumber)\r\n                if(checkUserExist) {\r\n                    resolve('User exist')\r\n                }else{\r\n                    reject('No such user')\r\n                }\r\n            })\r\n            promise\r\n                .then(() => {\r\n                    this.props.setCurrentDialogId(dialogIdNumber)\r\n                })\r\n                .catch(() => {\r\n                    this.props.setCurrentDialogId(null)\r\n                })\r\n        }\r\n        if(!dialogId && dialogIdNumber !== this.props.currentDialogId){\r\n            this.props.setCurrentDialogId(null)\r\n        }\r\n    }\r\n\r\n\r\n\r\n    setUsersFromDialogsArray = (dialogs: Array<DialogType>) => {\r\n        dialogs.forEach(dialog => {\r\n            if(dialog.opponentId){\r\n                this.props.setUser(dialog.opponentId)\r\n            }\r\n        })\r\n\r\n    }\r\n\r\n    findUserInUsersArray = (userId: number) => {\r\n        let thisUser = null\r\n        if(this.props.users[0]){\r\n            this.props.users.forEach((user) => {\r\n                if(user.userId === userId){\r\n                    thisUser = user\r\n                }\r\n            })\r\n        }\r\n\r\n        return thisUser\r\n    }\r\n\r\n\r\n\r\n    render () {\r\n        return (\r\n            <>\r\n                <Helmet>\r\n                    <title>{this.props.currentUser && !this.props.isMessagesLoading ? this.props.currentUser.fullName+' - messages' : 'Dialogs'}</title>\r\n                </Helmet>\r\n                <Dialogs\r\n                    currentDialogId={this.props.currentDialogId}\r\n                    currentUser={this.props.currentUser}\r\n                    dialogs={this.props.dialogs}\r\n                    messages={this.props.messages}\r\n                    users={this.props.users}\r\n\r\n                    isMessageFetching={this.props.isMessageFetching}\r\n                    isMessagesLoading={this.props.isMessagesLoading}\r\n\r\n                    sendMessage={this.props.sendMessage}\r\n                    setDialog={this.props.setDialog}\r\n                    findUserInUsersArray={this.findUserInUsersArray}\r\n                />\r\n            </>\r\n        )\r\n    }\r\n\r\n}\r\n\r\n\r\n\r\nconst mapStateToProps = (state: AppStateType) => {\r\n    return {\r\n        currentDialogId: getCurrentDialogId(state),\r\n        currentUser: getCurrentUser(state),\r\n        dialogs: getDialogs(state),\r\n        messages: getMessages(state),\r\n        users: getUsers(state),\r\n        isMessageFetching: getIsMessageFetching(state),\r\n        isMessagesLoading: getIsMessagesLoading(state)\r\n    }\r\n}\r\n\r\nconst mapDispatchToProps: MapDispatchToPropsType = {\r\n    setCurrentDialogId: actions.setCurrentDialogId,\r\n    setCurrentUser,\r\n    sendMessage,\r\n    setUser,\r\n    setDialog: actions.setDialog,\r\n    checkUser\r\n}\r\n\r\n\r\n\r\nexport default compose<React.ComponentType>(\r\n    connect(mapStateToProps, mapDispatchToProps),\r\n    withRouter,\r\n    withAuthRedirect // Protect from non-auth users\r\n)(DialogsContainer)"],"sourceRoot":""}