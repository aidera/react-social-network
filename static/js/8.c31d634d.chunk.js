(this["webpackJsonpway-of-samurai"]=this["webpackJsonpway-of-samurai"]||[]).push([[8],{106:function(e,a,s){"use strict";s.d(a,"a",(function(){return d}));var t=s(45),r=s(44),n=s(0),o=s.n(n),i=s(115),l=s.n(i),c=s(105),u=s(16),m=s.n(u),g=s(132),p=s.n(g),d=o.a.memo((function(e){var a=e.name,s=e.label,i=e.fieldType,u=e.maxLength,g=e.placeholder,d=e.type,f=e.onKeyDown,h=e.autoFocus,A=Object(c.d)(a),b=Object(r.a)(A,2),E=b[0],v=b[1],F=v.error,I=v.touched,M=Object(n.useRef)(null);Object(n.useEffect)((function(){M&&M.current&&p()(M.current)}));var y=function(){return o.a.createElement(o.a.Fragment,null,!!s&&o.a.createElement("label",{htmlFor:"form-"+a},s),o.a.createElement(c.a,Object.assign({as:"input",id:"form-"+a,className:l.a.simpleField,placeholder:g,maxLength:u,type:d,autoFocus:h},E)),N(E.value.length,u),W(F,I))},D=function(){return o.a.createElement(o.a.Fragment,null,!!s&&o.a.createElement("label",{htmlFor:"form-"+a},s),o.a.createElement("textarea",Object.assign({id:"form-"+a,rows:1,ref:M,className:l.a.simpleField,placeholder:g,maxLength:u,onKeyDown:f,autoFocus:h},E)),N(E.value.length,u),W(F,I))},L=function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:l.a.checkboxInput},o.a.createElement(c.a,Object.assign({id:"form-"+a,type:"checkbox",checked:E.value,placeholder:g},E)),o.a.createElement("label",{htmlFor:"form-"+a},s)),W(F,I))},W=function(e,a){if(e&&a)return o.a.createElement("div",{className:l.a.fieldError},e)},N=function(e,a){if(a)return o.a.createElement("div",{className:m()(l.a.maxLength,Object(t.a)({},l.a.error,e>=a))},e,"/",a)};return o.a.createElement("div",{className:l.a.fieldGroup},function(){switch(i){case"input":return y();case"textarea":return D();case"checkbox":return L();default:return y()}}())}))},109:function(e,a){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpFNzg0MTZGRTE3M0UxMUUzOTYyOEE4QkM2OUVGODdCNyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpFNzg0MTZGRjE3M0UxMUUzOTYyOEE4QkM2OUVGODdCNyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkU3ODQxNkZDMTczRTExRTM5NjI4QThCQzY5RUY4N0I3IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkU3ODQxNkZEMTczRTExRTM5NjI4QThCQzY5RUY4N0I3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+b5NvTwAAADNQTFRF3t7e6urq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"},115:function(e,a,s){e.exports={fieldGroup:"CustomFormControls_fieldGroup__3ichb",simpleField:"CustomFormControls_simpleField__21tGG",maxLength:"CustomFormControls_maxLength__1jqRO",error:"CustomFormControls_error__bVcUE",fieldError:"CustomFormControls_fieldError__MVOSL",checkboxInput:"CustomFormControls_checkboxInput__xnNWt"}},142:function(e,a,s){"use strict";function t(e,a){if(null==e)return{};var s,t,r=function(e,a){if(null==e)return{};var s,t,r={},n=Object.keys(e);for(t=0;t<n.length;t++)s=n[t],a.indexOf(s)>=0||(r[s]=e[s]);return r}(e,a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(t=0;t<n.length;t++)s=n[t],a.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(e,s)&&(r[s]=e[s])}return r}s.d(a,"a",(function(){return t}))},185:function(e,a,s){e.exports={dialogs:"Dialogs_dialogs__azdOc",showDialogsList:"Dialogs_showDialogsList__17vwK",dialogsContainer:"Dialogs_dialogsContainer__1N79k",dialogsList:"Dialogs_dialogsList__3HEzI",messagesList:"Dialogs_messagesList__2HwY3",userName:"Dialogs_userName__9Hulc",sendMessageBlock:"Dialogs_sendMessageBlock__2OxWB",noDialogMessage:"Dialogs_noDialogMessage__MvAt8",formSummaryError:"Dialogs_formSummaryError__2xduC"}},186:function(e,a,s){e.exports={dialog:"Dialog_dialog__2dEEq",user:"Dialog_user__2rFFt",active:"Dialog_active__2dkw_"}},187:function(e,a,s){e.exports={message:"Message_message__2LqB3",messageInnerContainer:"Message_messageInnerContainer__eXKYE",messageFrom:"Message_messageFrom__1V-4M",time:"Message_time__Hvkbo",myMessage:"Message_myMessage__YwGM2"}},188:function(e,a,s){e.exports=s.p+"static/media/send-message_white.147a79aa.svg"},189:function(e,a,s){e.exports=s.p+"static/media/arrow-left.55da2725.svg"},215:function(e,a,s){"use strict";s.r(a);var t=s(18),r=s(19),n=s(21),o=s(20),i=s(1),l=s.n(i),c=s(3),u=s(0),m=s.n(u),g=s(185),p=s.n(g),d=s(186),f=s.n(d),h=s(8),A=s(46),b=s(109),E=s.n(b),v=m.a.memo((function(e){var a=e.user;return m.a.createElement("div",{className:f.a.dialog},!!a&&m.a.createElement(h.b,{to:"/dialogs/"+a.userId,activeClassName:f.a.active,className:f.a.user},m.a.createElement("img",{src:a.photos&&(a.photos.small||E.a),alt:a.fullName}),m.a.createElement("span",null,a.fullName)),!a&&m.a.createElement(A.a,null))})),F=s(45),I=s(187),M=s.n(I),y=s(16),D=s.n(y),L=m.a.memo((function(e){var a=e.messageText,s=e.from,t=e.date,r=e.opponent,n="opponent:";return r&&(n=r.fullName+":"),m.a.createElement("div",{className:D()(M.a.message,Object(F.a)({},M.a.myMessage,"me"===s))},m.a.createElement("div",{className:M.a.messageInnerContainer},m.a.createElement("div",{className:M.a.messageFrom},"me"===s?"me:":n),m.a.createElement("div",{className:M.a.messageText},a),m.a.createElement("div",{className:M.a.time},function(e){var a=new Date(e);return a.getHours()+":"+("0"+a.getMinutes()).substr(-2)}(t))))})),W=s(106),N=s(105),U=s(188),j=s.n(U),x=s(189),Y=s.n(x),O=s(38),G=m.a.memo((function(e){var a=e.dialogs,s=e.messages,t=e.sendMessage,r=e.currentDialogId,n=e.currentUser,o=e.isMessageFetching,i=e.isMessagesLoading,g=e.findUserInUsersArray,d=function(){var e=Object(c.a)(l.a.mark((function e(a,s){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a.message.length>0)||o||i){e.next=12;break}if(e.prev=1,!r){e.next=7;break}return e.next=5,t(r,a.message,Date.now());case 5:h(),s.resetForm({message:""});case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),s.setFieldError("general",e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(a,s){return e.apply(this,arguments)}}(),f=Object(u.useRef)(null),h=function(){var e=f.current;e&&e.scrollTo(0,e.scrollHeight)};Object(u.useEffect)((function(){h()}));var A=Object(u.useRef)(null),b=Object(u.useRef)(null),E=A.current,F=b.current,I=function(){E&&F&&(E.style.left="-100%",F.style.left="0px")};Object(u.useEffect)((function(){r&&I()}));var M=n&&n.fullName;return m.a.createElement("div",{className:p.a.dialogs},m.a.createElement("div",{ref:b,onClick:function(){E&&F&&(E.style.left="0px",F.style.left="200%")},className:p.a.showDialogsList},m.a.createElement("img",{src:Y.a,alt:"show dialogs"}),m.a.createElement("span",null,!i&&M)),m.a.createElement("div",{ref:f,className:p.a.dialogsContainer},m.a.createElement("div",{ref:A,onClick:I,className:p.a.dialogsList},a.map((function(e){var a=g(e.opponentId);return m.a.createElement(v,{key:e.id,user:a})}))),m.a.createElement("div",{className:p.a.userName},!(o||i)&&M),m.a.createElement("div",{className:p.a.messagesList},!i&&m.a.createElement(m.a.Fragment,null,s.map((function(e){if(e.opponentId===r){var a=g(e.opponentId);return m.a.createElement(L,{key:e.id,opponent:a,from:e.from,messageText:e.messageText,date:e.date})}return null}))),i&&m.a.createElement(O.a,null)),!!r&&m.a.createElement(N.c,{initialValues:{message:"",general:""},onSubmit:function(e,a){d(e,a)}},(function(e){return m.a.createElement(N.b,{className:p.a.sendMessageBlock},m.a.createElement(W.a,{name:"message",fieldType:"textarea",placeholder:'Type something besides "ghbdtn" ) ',onKeyDown:function(a){"Enter"===a.key&&(a.shiftKey||(a.preventDefault(),e.handleSubmit()))}}),e.errors.general?m.a.createElement("div",{className:p.a.formSummaryError},e.errors.general):null,!(o||i)&&m.a.createElement("button",{type:"submit",className:D()("button","button-success")},m.a.createElement("img",{src:j.a,alt:"send message"})))})),(!r||!n)&&m.a.createElement("div",{className:p.a.noDialogMessage},m.a.createElement("span",null,"Choose user to start conversation"))))})),V=s(59),w=s(26),C=s(142),k=s(6),R=function(e){return{isAuth:e.auth.isAuth}};var _=s(15),P=function(e){return e.dialogsPage.currentDialogId},T=function(e){return e.dialogsPage.currentUser},S=function(e){return e.dialogsPage.messages},B=function(e){return e.dialogsPage.dialogs},Z=function(e){return e.dialogsPage.users},z=function(e){return e.dialogsPage.isMessageFetching},X=function(e){return e.dialogsPage.isMessagesLoading},J=s(104),H=function(e){Object(n.a)(s,e);var a=Object(o.a)(s);function s(){var e;Object(t.a)(this,s);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=a.call.apply(a,[this].concat(n))).setCurrentDialogIdFromUrl=function(){var a=e.props.match.params.dialogId,s=Number(a);a&&s!==e.props.currentDialogId&&new Promise((function(a,t){e.props.checkUser(s)?a("User exist"):t("No such user")})).then((function(){e.props.setCurrentDialogId(s)})).catch((function(){e.props.setCurrentDialogId(null)}));a||s===e.props.currentDialogId||e.props.setCurrentDialogId(null)},e.setUsersFromDialogsArray=function(a){a.forEach((function(a){a.opponentId&&e.props.setUser(a.opponentId)}))},e.findUserInUsersArray=function(a){var s=null;return e.props.users[0]&&e.props.users.forEach((function(e){e.userId===a&&(s=e)})),s},e}return Object(r.a)(s,[{key:"componentDidMount",value:function(){this.setCurrentDialogIdFromUrl(),this.setUsersFromDialogsArray(this.props.dialogs)}},{key:"componentDidUpdate",value:function(e){this.setCurrentDialogIdFromUrl(),e.dialogs!==this.props.dialogs&&this.setUsersFromDialogsArray(this.props.dialogs),e.currentDialogId!==this.props.currentDialogId&&this.props.setCurrentUser(this.props.currentDialogId)}},{key:"render",value:function(){return m.a.createElement(m.a.Fragment,null,m.a.createElement(J.a,null,m.a.createElement("title",null,this.props.currentUser&&!this.props.isMessagesLoading?this.props.currentUser.fullName+" - messages":"Dialogs")),m.a.createElement(G,{currentDialogId:this.props.currentDialogId,currentUser:this.props.currentUser,dialogs:this.props.dialogs,messages:this.props.messages,users:this.props.users,isMessageFetching:this.props.isMessageFetching,isMessagesLoading:this.props.isMessagesLoading,sendMessage:this.props.sendMessage,setDialog:this.props.setDialog,findUserInUsersArray:this.findUserInUsersArray}))}}]),s}(m.a.PureComponent),q={setCurrentDialogId:V.a.setCurrentDialogId,setCurrentUser:V.e,sendMessage:V.d,setUser:V.f,setDialog:V.a.setDialog,checkUser:V.b};a.default=Object(_.d)(Object(w.b)((function(e){return{currentDialogId:P(e),currentUser:T(e),dialogs:B(e),messages:S(e),users:Z(e),isMessageFetching:z(e),isMessagesLoading:X(e)}}),q),k.g,(function(e){return Object(w.b)(R)((function(a){var s=a.isAuth,t=Object(C.a)(a,["isAuth"]);return s?m.a.createElement(e,t):m.a.createElement(k.a,{to:"/login"})}))}))(H)}}]);
//# sourceMappingURL=8.c31d634d.chunk.js.map